CREATE VIEW `report_register_by_school_year` AS
SELECT
	applicants.pmb AS pmb,
	applicants.year AS year,
    applicants.identity_user AS identity_user,
    SUM(CASE WHEN applicants.is_register = 1 THEN 1 ELSE 0 END) as register,
    schools.name AS name
FROM
	applicants
LEFT JOIN
	schools ON schools.id = applicants.school
WHERE
	schools.region IS NOT NULL AND schools.status IS NOT NULL AND schools.type IS NOT NULL AND applicants.is_register = 1
GROUP BY
	pmb, year, identity_user, name
ORDER BY
	pmb DESC, year DESC;
